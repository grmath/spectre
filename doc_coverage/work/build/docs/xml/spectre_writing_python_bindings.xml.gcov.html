<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">

<html lang="en">

<head>
  <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
  <title>LCOV - cbfbf67b7981e589bee915450d97bc54a82020ab - /work/build/docs/xml/spectre_writing_python_bindings.xml</title>
  <link rel="stylesheet" type="text/css" href="../../../../gcov.css">
</head>

<body>

  <table width="100%" border=0 cellspacing=0 cellpadding=0>
    <tr><td class="title"> SpECTRE Documentation Coverage Report</td></tr>
    <tr><td class="ruler"><img src="../../../../glass.png" width=3 height=3 alt=""></td></tr>

    <tr>
      <td width="100%">
        <table cellpadding=1 border=0 width="100%">
          <tr>
            <td width="10%" class="headerItem">Current view:</td>
            <td width="35%" class="headerValue"><a href="../../../../index.html">top level</a> - <a href="index.html">work/build/docs/xml</a> - spectre_writing_python_bindings.xml</td>
            <td width="5%"></td>
            <td width="15%"></td>
            <td width="10%" class="headerCovTableHead">Hit</td>
            <td width="10%" class="headerCovTableHead">Total</td>
            <td width="15%" class="headerCovTableHead">Coverage</td>
          </tr>
          <tr>
             <td class="headerItem">Commit:</td>
             <td class="headerValue"><a target="_blank" href="https://github.com/sxs-collaboration/spectre/commit/cbfbf67b7981e589bee915450d97bc54a82020ab">cbfbf67b7981e589bee915450d97bc54a82020ab</a></td>
            <td></td>
            <td class="headerItem">Lines:</td>
            <td class="headerCovTableEntry">1</td>
            <td class="headerCovTableEntry">1</td>
            <td class="headerCovTableEntryHi">100.0 %</td>
          </tr>
          <tr>
            <td class="headerItem">Date:</td>
            <td class="headerValue">2020-02-19 21:30:39</td>
            <td></td>
          </tr>
          <tr>
            <td class="headerItem">Legend:</td>
            <td class="headerValueLeg">            Lines:
            <span class="coverLegendCov">hit</span>
            <span class="coverLegendNoCov">not hit</span>
</td>
            <td></td>
          </tr>
          <tr><td><img src="../../../../glass.png" width=3 height=3 alt=""></td></tr>
        </table>
      </td>
    </tr>

    <tr><td class="ruler"><img src="../../../../glass.png" width=3 height=3 alt=""></td></tr>
  </table>

  <table cellpadding=0 cellspacing=0 border=0>
    <tr>
      <td><br></td>
    </tr>
    <tr>
      <td>
<pre class="sourceHeading">          Line data    Source code</pre>
<pre class="source">
<span class="lineNum">       1 </span><span class="lineCov">          1 : &lt;?xml version='1.0' encoding='UTF-8' standalone='no'?&gt;</span>
<span class="lineNum">       2 </span>            : &lt;doxygen xmlns:xsi=&quot;http://www.w3.org/2001/XMLSchema-instance&quot; xsi:noNamespaceSchemaLocation=&quot;compound.xsd&quot; version=&quot;1.8.13&quot;&gt;
<span class="lineNum">       3 </span>            :   &lt;compounddef id=&quot;spectre_writing_python_bindings&quot; kind=&quot;page&quot;&gt;
<span class="lineNum">       4 </span>            :     &lt;compoundname&gt;spectre_writing_python_bindings&lt;/compoundname&gt;
<span class="lineNum">       5 </span>            :     &lt;title&gt;Writing Python Bindings&lt;/title&gt;
<span class="lineNum">       6 </span>            :     &lt;detaileddescription&gt;
<span class="lineNum">       7 </span>            : &lt;para&gt;&lt;heading level=&quot;2&quot;&gt;CMake and Directory Layout&lt;/heading&gt;
<span class="lineNum">       8 </span>            : &lt;/para&gt;&lt;para&gt;To allow users to analyze output from simulations and take advantage of SpECTRE&amp;apos;s data structures and functions in python, bindings must sometimes be written. SpECTRE uses &lt;ulink url=&quot;https://pybind11.readthedocs.io/&quot;&gt;pybind11&lt;/ulink&gt; to aid with generating the bindings. The C++ code for the bindings should generally go in a &lt;computeroutput&gt;Python&lt;/computeroutput&gt; subdirectory. For example, the bindings for the DataStructures library would go in &lt;computeroutput&gt;src/DataStructures/Python/&lt;/computeroutput&gt;. SpECTRE provides the &lt;computeroutput&gt;spectre_python_add_module&lt;/computeroutput&gt; CMake function to make adding a new python module, be it with or without bindings, easy. The python bindings are built only if &lt;computeroutput&gt;-D BUILD_PYTHON_BINDINGS=ON&lt;/computeroutput&gt; is passed when invoking cmake. You can specify the Python version, interpreter and libraries used for compiling and testing the bindings by setting the &lt;computeroutput&gt;-D PYTHON_EXECUTABLE&lt;/computeroutput&gt; to an absolute path such as &lt;computeroutput&gt;/usr/bin/python3&lt;/computeroutput&gt;.&lt;/para&gt;&lt;para&gt;The function &lt;computeroutput&gt;spectre_python_add_module&lt;/computeroutput&gt; takes as its first argument the module, in our case &lt;computeroutput&gt;DataStructures&lt;/computeroutput&gt;. Optionally, a list of &lt;computeroutput&gt;SOURCES&lt;/computeroutput&gt; can be passed to the CMake function. If you specify &lt;computeroutput&gt;SOURCES&lt;/computeroutput&gt;, you must also specify a &lt;computeroutput&gt;LIBRARY_NAME&lt;/computeroutput&gt;. A good &lt;computeroutput&gt;LIBRARY_NAME&lt;/computeroutput&gt; is the name of the C++ library for which bindings are being built prefixed with &lt;computeroutput&gt;Py&lt;/computeroutput&gt;, e.g. &lt;computeroutput&gt;PyDataStructures&lt;/computeroutput&gt;. If the Python module will only consist of Python files, then the &lt;computeroutput&gt;SOURCES&lt;/computeroutput&gt; option should not be specified. Python files that should be part of the module can be passed with the keyword &lt;computeroutput&gt;PYTHON_FILES&lt;/computeroutput&gt;, e.g. &lt;computeroutput&gt;PYTHON_FILES Hello.py HelloWorld.py&lt;/computeroutput&gt;. Finally, the &lt;computeroutput&gt;MODULE_PATH&lt;/computeroutput&gt; named argument can be passed with a string that is the path to where the module should be. For example, &lt;computeroutput&gt;MODULE_PATH &amp;quot;submodule0/submodule1/&amp;quot;&lt;/computeroutput&gt; would mean the module is accessed from python using &lt;computeroutput&gt;import spectre.submodule0.submodule1.MODULE_NAME&lt;/computeroutput&gt;.&lt;/para&gt;&lt;para&gt;Here is a complete example of how to call the &lt;computeroutput&gt;spectre_python_add_module&lt;/computeroutput&gt; function:&lt;/para&gt;&lt;para&gt;&lt;programlisting&gt;&lt;codeline&gt;&lt;highlight class=&quot;normal&quot;&gt;spectre_python_add_module(&lt;/highlight&gt;&lt;/codeline&gt;
<span class="lineNum">       9 </span>            : &lt;codeline&gt;&lt;highlight class=&quot;normal&quot;&gt;&lt;sp/&gt;&lt;sp/&gt;Extra&lt;/highlight&gt;&lt;/codeline&gt;
<span class="lineNum">      10 </span>            : &lt;codeline&gt;&lt;highlight class=&quot;normal&quot;&gt;&lt;sp/&gt;&lt;sp/&gt;LIBRARY_NAME&lt;sp/&gt;&amp;quot;PyExtraDataStructures&amp;quot;&lt;/highlight&gt;&lt;/codeline&gt;
<span class="lineNum">      11 </span>            : &lt;codeline&gt;&lt;highlight class=&quot;normal&quot;&gt;&lt;sp/&gt;&lt;sp/&gt;MODULE_PATH&lt;sp/&gt;&amp;quot;DataStructures/&amp;quot;&lt;/highlight&gt;&lt;/codeline&gt;
<span class="lineNum">      12 </span>            : &lt;codeline&gt;&lt;highlight class=&quot;normal&quot;&gt;&lt;sp/&gt;&lt;sp/&gt;SOURCES&lt;sp/&gt;Bindings.cpp&lt;sp/&gt;MyCoolDataStructure.cpp&lt;/highlight&gt;&lt;/codeline&gt;
<span class="lineNum">      13 </span>            : &lt;codeline&gt;&lt;highlight class=&quot;normal&quot;&gt;&lt;sp/&gt;&lt;sp/&gt;PYTHON_FILES&lt;sp/&gt;CoolPythonDataStructure.py&lt;/highlight&gt;&lt;/codeline&gt;
<span class="lineNum">      14 </span>            : &lt;codeline&gt;&lt;highlight class=&quot;normal&quot;&gt;&lt;sp/&gt;&lt;sp/&gt;)&lt;/highlight&gt;&lt;/codeline&gt;
<span class="lineNum">      15 </span>            : &lt;/programlisting&gt;&lt;/para&gt;&lt;para&gt;The library that is added has the name &lt;computeroutput&gt;PyExtraDataStructures&lt;/computeroutput&gt;. Make sure to call &lt;computeroutput&gt;spectre_python_link_libraries&lt;/computeroutput&gt; for every Python module that compiles &lt;computeroutput&gt;SOURCES&lt;/computeroutput&gt;. For example,&lt;/para&gt;&lt;para&gt;&lt;programlisting&gt;&lt;codeline&gt;&lt;highlight class=&quot;normal&quot;&gt;spectre_python_link_libraries(&lt;/highlight&gt;&lt;/codeline&gt;
<span class="lineNum">      16 </span>            : &lt;codeline&gt;&lt;highlight class=&quot;normal&quot;&gt;&lt;sp/&gt;&lt;sp/&gt;PyExtraDataStructures&lt;/highlight&gt;&lt;/codeline&gt;
<span class="lineNum">      17 </span>            : &lt;codeline&gt;&lt;highlight class=&quot;normal&quot;&gt;&lt;sp/&gt;&lt;sp/&gt;PUBLIC&lt;sp/&gt;ExtraDataStructures&lt;/highlight&gt;&lt;/codeline&gt;
<span class="lineNum">      18 </span>            : &lt;codeline&gt;&lt;highlight class=&quot;normal&quot;&gt;&lt;sp/&gt;&lt;sp/&gt;)&lt;/highlight&gt;&lt;/codeline&gt;
<span class="lineNum">      19 </span>            : &lt;/programlisting&gt;&lt;/para&gt;&lt;para&gt;You may also call &lt;computeroutput&gt;spectre_python_add_dependencies&lt;/computeroutput&gt; for Python modules that have &lt;computeroutput&gt;SOURCES&lt;/computeroutput&gt;, e.g.&lt;/para&gt;&lt;para&gt;&lt;programlisting&gt;&lt;codeline&gt;&lt;highlight class=&quot;normal&quot;&gt;spectre_python_add_dependencies(&lt;/highlight&gt;&lt;/codeline&gt;
<span class="lineNum">      20 </span>            : &lt;codeline&gt;&lt;highlight class=&quot;normal&quot;&gt;&lt;sp/&gt;&lt;sp/&gt;PyExtraDataStructures&lt;/highlight&gt;&lt;/codeline&gt;
<span class="lineNum">      21 </span>            : &lt;codeline&gt;&lt;highlight class=&quot;normal&quot;&gt;&lt;sp/&gt;&lt;sp/&gt;PyDataStructures&lt;/highlight&gt;&lt;/codeline&gt;
<span class="lineNum">      22 </span>            : &lt;codeline&gt;&lt;highlight class=&quot;normal&quot;&gt;&lt;sp/&gt;&lt;sp/&gt;)&lt;/highlight&gt;&lt;/codeline&gt;
<span class="lineNum">      23 </span>            : &lt;/programlisting&gt;&lt;/para&gt;&lt;para&gt;Note that these functions will skip adding or configure any C++ libraries if the &lt;computeroutput&gt;BUILD_PYTHON_BINDINGS&lt;/computeroutput&gt; flag is &lt;computeroutput&gt;OFF&lt;/computeroutput&gt;.&lt;/para&gt;&lt;para&gt;&lt;heading level=&quot;2&quot;&gt;Writing Bindings&lt;/heading&gt;
<span class="lineNum">      24 </span>            : &lt;/para&gt;&lt;para&gt;Once a python module has been added you can write the actual bindings. You should structure your bindings directory to reflect the structure of the library you&amp;apos;re writing bindings for. For example, say we want bindings for &lt;computeroutput&gt;&lt;ref refid=&quot;classDataVector&quot; kindref=&quot;compound&quot;&gt;DataVector&lt;/ref&gt;&lt;/computeroutput&gt; and &lt;computeroutput&gt;&lt;ref refid=&quot;classMatrix&quot; kindref=&quot;compound&quot;&gt;Matrix&lt;/ref&gt;&lt;/computeroutput&gt; then we should have one source file for each class&amp;apos;s bindings inside &lt;computeroutput&gt;src/DataStructures/Python&lt;/computeroutput&gt;. The functions that generate the bindings should be in the &lt;computeroutput&gt;py_bindings&lt;/computeroutput&gt; namespace and have a reasonable name such as &lt;computeroutput&gt;bind_datavector&lt;/computeroutput&gt;. There should be a file named &lt;computeroutput&gt;Bindings.cpp&lt;/computeroutput&gt; which calls all the &lt;computeroutput&gt;bind_*&lt;/computeroutput&gt; functions. The &lt;computeroutput&gt;Bindings.cpp&lt;/computeroutput&gt; file is quite simple and should &lt;computeroutput&gt;include &amp;lt;pybind11/pybind11.h&amp;gt;&lt;/computeroutput&gt;, forward declare the &lt;computeroutput&gt;bind_*&lt;/computeroutput&gt; functions, and then have a &lt;computeroutput&gt;PYBIND11_MODULE&lt;/computeroutput&gt; function. For example,&lt;/para&gt;&lt;para&gt;&lt;programlisting&gt;&lt;codeline&gt;&lt;highlight class=&quot;preprocessor&quot;&gt;#include&lt;sp/&gt;&amp;lt;pybind11/pybind11.h&amp;gt;&lt;/highlight&gt;&lt;highlight class=&quot;normal&quot;&gt;&lt;/highlight&gt;&lt;/codeline&gt;
<span class="lineNum">      25 </span>            : &lt;codeline&gt;&lt;highlight class=&quot;normal&quot;&gt;&lt;/highlight&gt;&lt;/codeline&gt;
<span class="lineNum">      26 </span>            : &lt;codeline&gt;&lt;highlight class=&quot;normal&quot;&gt;&lt;/highlight&gt;&lt;highlight class=&quot;keyword&quot;&gt;namespace&lt;sp/&gt;&lt;/highlight&gt;&lt;highlight class=&quot;normal&quot;&gt;py&lt;sp/&gt;=&lt;sp/&gt;pybind11;&lt;/highlight&gt;&lt;/codeline&gt;
<span class="lineNum">      27 </span>            : &lt;codeline&gt;&lt;highlight class=&quot;normal&quot;&gt;&lt;/highlight&gt;&lt;/codeline&gt;
<span class="lineNum">      28 </span>            : &lt;codeline&gt;&lt;highlight class=&quot;normal&quot;&gt;&lt;/highlight&gt;&lt;highlight class=&quot;keyword&quot;&gt;namespace&lt;sp/&gt;&lt;/highlight&gt;&lt;highlight class=&quot;normal&quot;&gt;&lt;ref refid=&quot;namespacepy__bindings&quot; kindref=&quot;compound&quot;&gt;py_bindings&lt;/ref&gt;&lt;sp/&gt;{&lt;/highlight&gt;&lt;/codeline&gt;
<span class="lineNum">      29 </span>            : &lt;codeline&gt;&lt;highlight class=&quot;normal&quot;&gt;&lt;/highlight&gt;&lt;highlight class=&quot;keywordtype&quot;&gt;void&lt;/highlight&gt;&lt;highlight class=&quot;normal&quot;&gt;&lt;sp/&gt;bind_datavector(py::module&amp;amp;&lt;sp/&gt;m);&lt;/highlight&gt;&lt;/codeline&gt;
<span class="lineNum">      30 </span>            : &lt;codeline&gt;&lt;highlight class=&quot;normal&quot;&gt;}&lt;sp/&gt;&lt;sp/&gt;&lt;/highlight&gt;&lt;highlight class=&quot;comment&quot;&gt;//&lt;sp/&gt;namespace&lt;sp/&gt;py_bindings&lt;/highlight&gt;&lt;highlight class=&quot;normal&quot;&gt;&lt;/highlight&gt;&lt;/codeline&gt;
<span class="lineNum">      31 </span>            : &lt;codeline&gt;&lt;highlight class=&quot;normal&quot;&gt;&lt;/highlight&gt;&lt;/codeline&gt;
<span class="lineNum">      32 </span>            : &lt;codeline&gt;&lt;highlight class=&quot;normal&quot;&gt;PYBIND11_MODULE(_PyDataStructures,&lt;sp/&gt;m)&lt;sp/&gt;{&lt;/highlight&gt;&lt;/codeline&gt;
<span class="lineNum">      33 </span>            : &lt;codeline&gt;&lt;highlight class=&quot;normal&quot;&gt;&lt;sp/&gt;&lt;sp/&gt;py_bindings::bind_datavector(m);&lt;/highlight&gt;&lt;/codeline&gt;
<span class="lineNum">      34 </span>            : &lt;codeline&gt;&lt;highlight class=&quot;normal&quot;&gt;}&lt;/highlight&gt;&lt;/codeline&gt;
<span class="lineNum">      35 </span>            : &lt;/programlisting&gt;&lt;/para&gt;&lt;para&gt;Note that the library name is passed to &lt;computeroutput&gt;PYBIND11_MODULE&lt;/computeroutput&gt; and is prefixed with an underscore. The underscore is important and the library name must be the same that is passed as &lt;computeroutput&gt;LIBRARY_NAME&lt;/computeroutput&gt; to &lt;computeroutput&gt;spectre_python_add_module&lt;/computeroutput&gt; (see above).&lt;/para&gt;&lt;para&gt;The &lt;computeroutput&gt;&lt;ref refid=&quot;classDataVector&quot; kindref=&quot;compound&quot;&gt;DataVector&lt;/ref&gt;&lt;/computeroutput&gt; bindings serve as an example with code comments on how to write bindings for a class. There is also extensive documentation available directly from &lt;ulink url=&quot;https://pybind11.readthedocs.io/&quot;&gt;pybind11&lt;/ulink&gt;. SpECTRE currently aims to support both Python 2.7 and Python 3 and as such all bindings must support both.&lt;/para&gt;&lt;para&gt;&lt;simplesect kind=&quot;note&quot;&gt;&lt;para&gt;Exceptions should be allowed to propagate through the bindings so that error handling via exceptions is possible from python rather than having the python interpreter being killed with a call to &lt;computeroutput&gt;abort&lt;/computeroutput&gt;.&lt;/para&gt;&lt;/simplesect&gt;
<span class="lineNum">      36 </span>            : &lt;heading level=&quot;2&quot;&gt;Testing Python Bindings and Code&lt;/heading&gt;
<span class="lineNum">      37 </span>            : &lt;/para&gt;&lt;para&gt;All the python bindings must be tested. SpECTRE uses the &lt;ulink url=&quot;https://docs.python.org/3/library/unittest.html&quot;&gt;unittest&lt;/ulink&gt; framework provided as part of python. To register a test file with CMake use the SpECTRE-provided function &lt;computeroutput&gt;spectre_add_python_test&lt;/computeroutput&gt; passing as the first argument the test name (e.g. &lt;computeroutput&gt;&amp;quot;Unit.DataStructures.Python.DataVector&amp;quot;&lt;/computeroutput&gt;), the file as the second argument (e.g. &lt;computeroutput&gt;Test_DataVector.py&lt;/computeroutput&gt;), and a semicolon separated list of labels as the last (e.g. &lt;computeroutput&gt;&amp;quot;unit;datastructures;python&amp;quot;&lt;/computeroutput&gt;). All the test cases should be in a single class so that the python unit testing framework will run all test functions on a single invocation to avoid startup cost.&lt;/para&gt;&lt;para&gt;Below is an example of registering a python test file for bindings:&lt;/para&gt;&lt;para&gt;&lt;programlisting&gt;&lt;codeline&gt;&lt;highlight class=&quot;normal&quot;&gt;spectre_add_python_bindings_test(&lt;/highlight&gt;&lt;/codeline&gt;
<span class="lineNum">      38 </span>            : &lt;codeline&gt;&lt;highlight class=&quot;normal&quot;&gt;&lt;sp/&gt;&lt;sp/&gt;&lt;/highlight&gt;&lt;highlight class=&quot;stringliteral&quot;&gt;&amp;quot;Unit.DataStructures.Python.DataVector&amp;quot;&lt;/highlight&gt;&lt;highlight class=&quot;normal&quot;&gt;&lt;/highlight&gt;&lt;/codeline&gt;
<span class="lineNum">      39 </span>            : &lt;codeline&gt;&lt;highlight class=&quot;normal&quot;&gt;&lt;sp/&gt;&lt;sp/&gt;Test_DataVector.py&lt;/highlight&gt;&lt;/codeline&gt;
<span class="lineNum">      40 </span>            : &lt;codeline&gt;&lt;highlight class=&quot;normal&quot;&gt;&lt;sp/&gt;&lt;sp/&gt;&lt;/highlight&gt;&lt;highlight class=&quot;stringliteral&quot;&gt;&amp;quot;Unit;DataStructures;Python&amp;quot;&lt;/highlight&gt;&lt;highlight class=&quot;normal&quot;&gt;)&lt;/highlight&gt;&lt;/codeline&gt;
<span class="lineNum">      41 </span>            : &lt;/programlisting&gt; Python code that does not use bindings must also be tested. You can register the test file using the &lt;computeroutput&gt;spectre_add_python_test&lt;/computeroutput&gt; CMake function with the same signature as shown above.&lt;/para&gt;&lt;para&gt;&lt;heading level=&quot;2&quot;&gt;Using The Bindings&lt;/heading&gt;
<span class="lineNum">      42 </span>            : &lt;/para&gt;&lt;para&gt;See &lt;ref refid=&quot;spectre_using_python&quot; kindref=&quot;compound&quot;&gt;Using SpECTRE&amp;apos;s Python&lt;/ref&gt;&lt;/para&gt;&lt;para&gt;&lt;heading level=&quot;2&quot;&gt;Notes:&lt;/heading&gt;
<span class="lineNum">      43 </span>            : &lt;/para&gt;&lt;para&gt;&lt;itemizedlist&gt;
<span class="lineNum">      44 </span>            : &lt;listitem&gt;&lt;para&gt;All python libraries are dynamic/shared libraries.&lt;/para&gt;&lt;/listitem&gt;&lt;listitem&gt;&lt;para&gt;Exceptions should be allowed to propagate through the bindings so that error handling via exceptions is possible from python rather than having the python interpreter being killed with a call to &lt;computeroutput&gt;abort&lt;/computeroutput&gt;.&lt;/para&gt;&lt;/listitem&gt;&lt;listitem&gt;&lt;para&gt;All function arguments in Python bindings should be named using &lt;computeroutput&gt;py::arg&lt;/computeroutput&gt;. See the Python bindings in &lt;computeroutput&gt;IO/H5/&lt;/computeroutput&gt; for examples. Using the named arguments in Python code is optional, but preferred when it makes code more readable. In particular, use the argument names in the tests for the Python bindings so they are being tested as well. &lt;/para&gt;&lt;/listitem&gt;&lt;/itemizedlist&gt;
<span class="lineNum">      45 </span>            : &lt;/para&gt;    &lt;/detaileddescription&gt;
<span class="lineNum">      46 </span>            :   &lt;/compounddef&gt;
<span class="lineNum">      47 </span>            : &lt;/doxygen&gt;
</pre>
      </td>
    </tr>
  </table>
  <br>

  <table width="100%" border=0 cellspacing=0 cellpadding=0>
    <tr><td class="ruler"><img src="../../../../glass.png" width=3 height=3 alt=""></td></tr>
    <tr><td class="versionInfo">Generated by: <a href="http://ltp.sourceforge.net/coverage/lcov.php" target="_parent">LCOV version 1.13</a></td></tr>
  </table>
  <br>

</body>
</html>
